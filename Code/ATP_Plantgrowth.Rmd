---
title: "Plant Growth Indices"
author: "S.Y. CHIA"
date: "January 16 2023"
output: html_document
editor_options: 
chunk_output_type: console
---

# Load required R libraries

```{r}

library(ggplot2)
library(car)
library(agricolae)
library(ggpubr)
library(emmeans)
library(multcompView)
library(plotrix) # for bar plots
library(lme4)
library(tidyverse)
library(RColorBrewer)
library(GGally)
library(lattice)
library(ggthemes)
library(DHARMa)
library(rmarkdown)

```

# Set working directory

```{r}

setwd("C:/ATP_PROJECT/Data")


```

# Load and prepare the data

## Read in LEAF AREA data - trial 1
## Read in LEAF AREA data - trial 2

## Read in LEAF NUMBER data - trial 1
## Read in LEAF NUMBER data - trial 2
```{r}

LA1<-read.table("Leafarea_trial_1.txt",header=TRUE)
LA2<-read.table("Leafarea_trial_2.txt",header=TRUE)
LN1<-read.table("Number_of_leaves_trial_1.txt",header=TRUE)
LN2<-read.table("Number_of_leaves_trial_2.txt",header=TRUE)

```

# Save data in appropriate format: 
## Set the variable characteristics correctly for LA1, LA2, LN1, LN2
### specify factor and numeric variables

```{r}

LA1$amendment1 <- as.factor(LA1$amendment1)
LA1$time1 <- as.factor(LA1$time1) 
LA1$plant_id1 <- as.factor(LA1$plant_id1)
LA1$leafarea1 <- as.numeric(LA1$leafarea1)

LA2$amendment2 <- as.factor(LA2$amendment2)
LA2$time2 <- as.factor(LA2$time2) 
LA2$plant_id2 <- as.factor(LA2$plant_id2)
LA2$leafarea2 <- as.numeric(LA2$leafarea2)


LN1$amendment1 <- as.factor(LN1$amendment1)
LN1$time1 <- as.factor(LN1$time1) 
LN1$plant_id1 <- as.factor(LN1$plant_id1)
LN1$no_leaves1 <- as.numeric(LN1$no_leaves1)

LN2$amendment2 <- as.factor(LN2$amendment2)
LN2$time2 <- as.factor(LN2$time2) 
LN2$plant_id2 <- as.factor(LN2$plant_id2)
LN2$no_leaves2 <- as.numeric(LN2$no_leaves2)

```

# View data structure and summary stats

```{r}

str(GrowthData)
summary()

```

# Visualize data
## Using boxplots, Q-Q Plots, bar graphs or scatter plots
   'QQ Plot stands for Quantile vs Quantile Plot, which is exactly what it does: plotting theoretical       quantiles against the actual quantiles of our variable'.
### Leaf Area (LA)

```{r}

P <- ggplot(data = LA1, aes(x = amendment1, y = leafarea1))
    P + geom_boxplot()
    P + geom_col()
ggplot(data = LA1, aes(x = amendment1, y = leafarea1)) + geom_point()


P1 <- ggplot(data = LA2, aes(x = amendment2, y = leafarea2))
    P1 + geom_boxplot()
    P1 + geom_col()
ggplot(data = LA2, aes(x = amendment2, y = leafarea2)) + geom_point()

```

### Number of leaves (LN)

```{r}

P2 <- ggplot(data = LN1, aes(x = amendment1, y = no_leaves1))
    P2 + geom_boxplot()
    P2 + geom_col()
ggplot(data = LN1, aes(x = amendment1, y = no_leaves1)) + geom_point()


P3 <- ggplot(data = LN2, aes(x = amendment2, y = no_leaves2))
    P3 + geom_boxplot()
    P3 + geom_col()
ggplot(data = LN2, aes(x = amendment2, y = no_leaves1)) + geom_point()

```

# Test for homogeneity of variance
## Leaf Area (LA)

```{r}

leveneTest(leafdarea1 ~ amendment1, data = LA1)
fligner.test(leafdarea1 ~ amendment1, data = LA1)
bartlett.test(leafdarea1 ~ amendment1, data = LA1) 

leveneTest(leafdarea2 ~ amendment2, data = LA2)
fligner.test(leafdarea2 ~ amendment2, data = LA2)
bartlett.test(leafdarea12~ amendment2, data = LA2) 

```

## Homogeneity - Number of leaves (LN)

```{r}
leveneTest(no_leaves1 ~ amendment1, data = LN1)
fligner.test(no_leaves1 ~ amendment1, data = LN1)
bartlett.test(no_leaves1 ~ amendment1, data = LN1)

leveneTest(no_leaves2 ~ amendment2, data = LN1)
fligner.test(no_leaves2 ~ amendment2, data = LN1)
bartlett.test(no_leaves2 ~ amendment2, data = LN1) 

```

# Test for Normality of variances: 

If the sample size is large enough (n > 30), we can ignore the distribution of the data and use parametric tests. The **central limit theorem** tells us that no matter what distribution things have, 
the sampling distribution tends to be normal if the sample is large enough (n > 30).

## Shapiro-Wilk test (recommended by Ghasemi & Zahediasl, 2002, doi: 10.5812/ijem.3505). It provides better power than K-S. It is based on the correlation between the data and the corresponding normal scores.
## Leaf Area, Leaf number

```{r}
shapiro.test(LA1$leafarea1)
shapiro.test(LA2$leafarea2)

shapiro.test(LN1$no_leaves1)
shapiro.test(LN2$no_leaves2)




``` 

# Data analysis
## Leaf Area data
### Fit a mixed model: amendment effect is fixed, time and plant_id are random and independent.

```{r}

fit.LA1 <- lmer(leafarea1 ~ amendment1 + (1|time1) + (1|plant_id1) )
summary(fit.LA1)
Anova(fit.LA1)

```
